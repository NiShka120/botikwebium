import logging
import time
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup, InputMediaPhoto, InputMediaVideo, InputMediaAudio
from telegram.ext import Updater, CommandHandler, MessageHandler, Filters, CallbackContext, CallbackQueryHandler

logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(name)s - %(levelname)s - %(message)s')
logger = logging.getLogger(__name__)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s', level=logging.INFO
)

logger = logging.getLogger(__name__)

TELEGRAM_API_TOKEN = '6110820995:AAGdCSosh8s_UVfH9gPWx_t2Yxia6jy8nQo'

TASKS = [
    {
        'task': '–ü–µ—Ä–≤—ã–π –∫–ª–æ—É–Ω –Ω–∞–¥ –Ω–∞–º–∏ –ø—Ä–∏–∫–∞–ª—ã–≤–∞–µ—Ç—Å—è! –ù–∞—á–∞–ª –Ω–æ—Å–∏—Ç—å –∫–æ–ª–ø–∞–∫–∏, —Ç–∞–∫ –µ—â–µ —Ä–∞–∑–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞ –∏ –≤ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç—è—Ö —Å–≤–æ–µ–π –≥–æ–ª–æ–≤—ã... –£—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ —ç—Ç–æ –ø–æ–¥—Å–∫–∞–∑–∫–∞... \n\n–ù–æ –Ω–∞—Å –Ω–µ –ø—Ä–æ–≤–µ–¥–µ—à—å! –ú—ã —Ç–æ—á–Ω–æ —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ –∫–ª–æ—É–Ω –ø—Ä–æ—Å—Ç–æ –∫—Ä–∏–≤–ª—è–µ—Ç—Å—è... \n\n–ï—â–µ –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ –∫–ª—é—á –∫ —Ä–µ—à–µ–Ω–∏—é –∑–∞–¥–∞—á–∏ –ª–µ–∂–∏—Ç –≤ –∫–æ–ª—é—á–∏—Ö —à–∞—Ä–∞—Ö... –®—É—Ç–Ω–∏–∫, –¥–∞?',
        'answers': ['?–≤–µ–±–∏–Ω–∞—Ä–∏—É–º',],
        'explanation': '–í–æ—Ç —ç—Ç–æ –¥–∞... –í—ã –≤–æ—Ç —Å–∫–∞–∑–∞–ª–∏ —ç—Ç–æ —á—É–¥–æ-—é–¥–æ —Å–ª–æ–≤–æ, –∞ —É –Ω–∞—Å —Å—Ä–∞–∑—É —á—Ç–æ-—Ç–æ –≤ –≥–æ–ª–æ–≤–µ —ë–∫–Ω—É–ª–æ... –ë—É–¥—Ç–æ –±—ã –Ω–∞—à —Ü–∏—Ä–∫ —Ä–∞–Ω—å—à–µ —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–ª—Å—è‚Ä¶ü§î \n\n–î–∞ –Ω–µ! –ï—Ä—É–Ω–¥–∞! –î–∞–≤–∞–π—Ç–µ –ª—É—á—à–µ –¥—Ä—É–≥–∏—Ö –∫–ª–æ—É–Ω–æ–≤ –∏—Å–∫–∞—Ç—å!',
        'time_limit': 10,
        'points': 5,
        'files': ['C:\\Users\\akshi\\Downloads\\Telegram Desktop\\qvest\\photo1.jpg',
                  'C:\\Users\\akshi\\Downloads\\Telegram Desktop\\Qvest\\AJ.mp4']
    },
    {   'task': '–ô–æ–æ–æ–æ–æ–º–∞–π–æ–æ–æ–æ!!!! –û–¥–∏–Ω –∏–∑ –Ω–∞—à–∏—Ö –∫–ª–æ—É–Ω–æ–≤ –æ—á–µ–Ω—å —Ö–æ—Ç–µ–ª —Å—Ç–∞—Ç—å —Ä–µ–∂–∏—Å—Å–µ—Ä–æ–º –∏ –¥–∞–∂–µ —Å—Ü–µ–Ω–∞—Ä–∏–π —Å–≤–æ–π –Ω–∞–ø–∏—Å–∞–ª... \n–í–æ—Ç –∫—É—Å–æ—á–µ–∫ –µ–≥–æ —Ç–≤–æ—Ä–µ–Ω–∏—è –∏ —Å–∞—É–Ω–¥—Ç—Ä–µ–∫ –∫ –∫–∞–∂–¥–æ–º—É –ø–µ—Ä—Å–æ–Ω–∞–∂—É –∏–∑ —Ñ–∏–ª—å–º–∞! –ö–∞–∂–µ—Ç—Å—è, —ç—Ç–æ –ø–æ–¥—Å–∫–∞–∑–∫–∞... \n\nü§ñ –ò–∑—É—á–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —ç—Ç–∏—Ö —Å—Ü–µ–Ω –∏ —Ä–µ—à–∏—Ç–µ –≤–∞–∂–Ω—É—é –∑–∞–≥–∞–¥–∫—É \n–ü–∏—à–∏—Ç–µ –≤ –æ—Ç–≤–µ—Ç –∏–º—è –ü–ï–†–°–û–ù–ê–ñ–ê, –∫–æ—Ç–æ—Ä—ã–π –ò–°–ü–û–õ–ù–Ø–õ –ü–ï–°–ù–Æ –í –≠–¢–û–ô –ö–û–ú–ü–û–ó–ò–¶–ò–ò.',
        'answers': ['?–º–µ—Ç–µ–ª—å'],
        'explanation': '–î–∞ –æ—Ç–∫—É–¥–∞ –≤—ã –≤—Å—ë –∑–Ω–∞–µ—Ç–µ??!!!?!! \n–Ø –≤–æ–æ–±—â–µ –≤ —à–æ–∫–µ! –ö–∞–∫ –º–æ–∂–Ω–æ –±—ã–ª–æ –≤—Å–ø–æ–º–Ω–∏—Ç—å ¬´–Å–ª–æ—á–∫—É¬ª –∏ –Ω–∞–∑–≤–∞—Ç—å –º–µ—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª–Ω—è–ª–∞ —ç—Ç—É –ø–µ—Å–Ω—é... –≠—Ç–æ —Ä–µ–∞–ª—å–Ω–æ —á—Ç–æ-—Ç–æ –Ω–µ–≤–æ–æ–±—Ä–∞–∑–∏–º–æ–µ üò±',
        'time_limit': 980,
        'points': 10,
        'files': [
            'C:\\Users\\akshi\\Downloads\\Telegram Desktop\\Qvest\\photo4.png',
            'C:\\Users\\akshi\\Downloads\\Telegram Desktop\\Qvest\\Arnold.mp3',
            'C:\\Users\\akshi\\Downloads\\Telegram Desktop\\Qvest\\Brus.mp3',
            'C:\\Users\\akshi\\Downloads\\Telegram Desktop\\Qvest\\Jeki.mp3',
            'C:\\Users\\akshi\\Downloads\\Telegram Desktop\\Qvest\\Zhan.mp3',
            'C:\\Users\\akshi\\Downloads\\Telegram Desktop\\Qvest\\Silvestr.mp3',
            'C:\\Users\\akshi\\Downloads\\Telegram Desktop\\Qvest\\Stiven.mp3'
        ]
    },
    {   'task': 'üëÄ –ó–∞–π–¥–∏—Ç–µ –≤ —ç—Ç—É –∫–æ–º–Ω–∞—Ç—É —Å–∫–æ—Ä–µ–µ!\n \n–°–º–æ—Ç—Ä–∏—Ç–µ–µ–µ, —Å–º–æ—Ç—Ä–∏—Ç–µ–µ–µ–µ! –í–∏–¥–∏—Ç–µ –≥–∏—Ä–ª—è–Ω–¥—É?? –°—Ç—Ä–∞–Ω–Ω–∞—è –æ–Ω–∞ –∫–∞–∫–∞—è-—Ç–æ... –ï—â–µ –∏ –Ω–∞–¥–ø–∏—Å–∏ –Ω–∞ —Å—Ç–µ–Ω–µ... –≠—Ç–æ –¢–û–ß–ù–û –∫–ª–æ—É–Ω! –î–∞–≤–∞–π –ø–æ–ø—Ä–æ–±—É–µ–º —Å–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å –≥–∏—Ä–ª—è–Ω–¥—É –∏ –Ω–∞–¥–ø–∏—Å–∏ –Ω–∞ —Å—Ç–µ–Ω–µ... –¢–æ–ª—å–∫–æ —è –Ω–µ –ø–æ–Ω–∏–º–∞—é, –∫–∞–∫ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å?\n \n–ù–∞–¥–æ –¥—É–º–∞—Ç—å!',
        'answers': ['?–º–æ–ª–æ–∫–æ'],
        'explanation': '–ú–æ–ª–æ–∫–æ? –ü—Ä–∏—á–µ–º —Ç—É—Ç –º–æ–ª–æ–∫–æ? \n–ö–∞–∫ –¥—É–º–∞–µ—Ç–µ, –Ω–∞–º –Ω–∞–¥–æ –∑–∞–ø–æ–º–∏–Ω–∞—Ç—å –æ—Ç–≤–µ—Ç—ã? –í–¥—Ä—É–≥ –≤ –∫–æ–Ω—Ü–µ –±—É–¥–µ—Ç –±–æ—Å—Å-–∫–ª–æ—É–Ω, –∏ –≤–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è —Å–∞–º–∏–º, –±–µ–∑ –º–µ–Ω—è —Å –Ω–∏–º —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è?\n \n–î–∞ –Ω–µ–µ–µ! –¢–∞–∫ —Ç–æ–ª—å–∫–æ –Ω–µ—Ö–æ—Ä–æ—à–∏–µ –≥–µ–π–º–¥–∏–∑–∞–π–Ω–µ—Ä—ã –¥–µ–ª–∞—é—Ç‚Ä¶ –ú—ã –Ω–µ –∏–∑ —Ç–∞–∫–∏—Ö ü´∂üèª',
        'time_limit': 720,
        'points': 5,
        'files': ['C:\\Users\\akshi\\Downloads\\Telegram Desktop\\qvest\\photo3.jpg']
    },
    {   'task': '–í—ã –ø–æ–≥–ª—è–¥–∏—Ç–µ! –¢—É—Ç –∫–ª–æ—É–Ω –æ—Å—Ç–∞–≤–∏–ª —Å—Ç–∏–∫–µ—Ä—ã —Å –∫–∞–∫–∏–º–∏-—Ç–æ –∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä–∞–º–∏! –î—É–º–∞—é, –Ω–∞–º –Ω—É–∂–Ω–æ –∏—Ö —Ä–∞–∑–≥–∞–¥–∞—Ç—å üò≥\n \n–ù–∞ —ç—Ç–æ–º —Å—Ç–∏–∫–µ—Ä–µ –Ω–∞–ø–∏—Å–∞–Ω–æ: "–£–∫–ü—Ä–£—Ç–¶–≤–û–±"! –Ø –∑–Ω–∞—é!!! –≠—Ç–æ ¬´–£–∫—Ä–∞—Å—å –ü—Ä–æ—â–∞–ª—å–Ω–æ–µ –£—Ç—Ä–æ –¶–≤–µ—Ç–∞–º–∏ –û–±–µ—â–∞–Ω–∏—è¬ª!!! –ê –≤–æ—Ç –æ—Å—Ç–∞–ª—å–Ω—ã–µ —è –Ω–µ –∑–Ω–∞—é :( \n–î–∞–≤–∞–π—Ç–µ –ø–æ–¥—É–º–∞–µ–º –≤–º–µ—Å—Ç–µ! \n \n(–ü–∏—à–∏—Ç–µ –æ—Ç–≤–µ—Ç –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤! –ù–∞–ø—Ä–∏–º–µ—Ä: ?–£–∫—Ä–∞—Å—å–ø—Ä–æ—â–∞–ª—å–Ω–æ–µ—É—Ç—Ä–æ—Ü–≤–µ—Ç–∞–º–∏–æ–±–µ—â–∞–Ω–∏—è)',
        'answers': ['?–≥–∞—Ä—Ä–∏–ø–æ—Ç—Ç–µ—Ä–∏—Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π–∫–∞–º–µ–Ω—å', '?—á–∞—Ä–ª–∏–∏—à–æ–∫–æ–ª–∞–¥–Ω–∞—è—Ñ–∞–±—Ä–∏–∫–∞', '?–ß–µ–ª–æ–≤–µ–∫–ø–∞—É–∫–≤–¥–∞–ª–∏–æ—Ç–¥–æ–º–∞', '?–í–ª–∞—Å—Ç–µ–ª–∏–Ω–∫–æ–ª–µ—Ü–±—Ä–∞—Ç—Å—Ç–≤–æ–∫–æ–ª—å—Ü–∞', '?–ú–∞–π–æ—Ä–≥—Ä–æ–º—á—É–º–Ω–æ–π–¥–æ–∫—Ç–æ—Ä', '?–ê–ª–∏—Å–∞–≤—Å—Ç—Ä–∞–Ω–µ—á—É–¥–µ—Å', '?–ü–∏—Ä–∞—Ç—ã–∫–∞—Ä–∏–±—Å–∫–æ–≥–æ–º–æ—Ä—è–ø—Ä–æ–∫–ª—è—Ç—å–µ—á–µ—Ä–Ω–æ–π–∂–µ–º—á—É–∂–∏–Ω—ã' ],
        'explanation': '–ù—É –∫—Ä—É—Ç–æ—Ç–∞! –ù—É —á—Ç–æ –∑–∞ —É–º–Ω–∏—á–∫–∏!! –ü–æ–π–¥–µ–º –∏—Å–∫–∞—Ç—å –¥–∞–ª—å—à–µ, –º–Ω–µ –∫–∞–∂–µ—Ç—Å—è, –º—ã —É–∂–µ –Ω–∞ —Ñ–∏–Ω–∏—à–Ω–æ–π –ø—Ä—è–º–æ–π. –ï—Å–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∏–º –≤ —Ç–∞–∫–æ–º –∂–µ —Ç–µ–º–ø–µ, —Ç–æ –≤—Å–µ –±—É–¥–µ—Ç –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ!',
        'time_limit': 720,
        'points': 7,
        'files': ['C:\\Users\\akshi\\Downloads\\Telegram Desktop\\qvest\\film1.png',
                'C:\\Users\\akshi\\Downloads\\Telegram Desktop\\qvest\\film2.png',
                'C:\\Users\\akshi\\Downloads\\Telegram Desktop\\qvest\\film3.png',
                'C:\\Users\\akshi\\Downloads\\Telegram Desktop\\qvest\\film4.png',
                'C:\\Users\\akshi\\Downloads\\Telegram Desktop\\qvest\\film5.png',
                'C:\\Users\\akshi\\Downloads\\Telegram Desktop\\qvest\\film6.png',
                'C:\\Users\\akshi\\Downloads\\Telegram Desktop\\qvest\\film7.png']
    },
    {   'task': '–û —É–∂–∞—Å! –Ø —Å–æ–≤—Å–µ–º –∑–∞–±—ã–ª, —á—Ç–æ —Å–µ–≥–æ–¥–Ω—è —É –Ω–∞—Å –≤—Å—Ç—Ä–µ—á–∞ —Å –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–º –≥–æ—Ä—è—â–∏—Ö –∫–æ–ª–µ—Ü –Ω–∞ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–µ! –°—Ä–æ—á–Ω–æ –Ω—É–∂–Ω–æ —É–∑–Ω–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ —Å–µ–π—á–∞—Å –≤—Ä–µ–º–µ–Ω–∏!!\n–ê –≤–æ—Ç –∏ —á–∞—Å—ã... \n \n–ö–∞–∂–µ—Ç—Å—è, —Å –Ω–∏–º–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫, –≤–º–µ—Å—Ç–æ —Ü–∏—Ñ—Ä —Ç—É—Ç –∂–∏–≤–æ—Ç–Ω—ã–µ, –∞ —Ä—è–¥–æ–º —Å —á–∞—Å–∞–º–∏ —É–∫–∞–∑–∞–Ω–æ –∫–∞–∫–æ–µ-—Ç–æ –≤—Ä–µ–º—è ü§®\n \n–í–∏–¥–∏–º–æ, —ç—Ç–æ –ø–æ–¥—Å–∫–∞–∑–∫–∞ –∫ —Ä–µ—à–µ–Ω–∏—é —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–∏. \n\nü§ñ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å —Ü–∏—Ñ–µ—Ä–±–ª–∞—Ç —Å –≤—Ä–µ–º–µ–Ω–µ–º, –∫–æ—Ç–æ—Ä–æ–µ —É–∫–∞–∑–∞–Ω–æ, —á—Ç–æ–±—ã —Ä–µ—à–∏—Ç—å –∑–∞–≥–∞–¥–∫—É!',
        'answers': ['?–∫–∏–Ω–æ–ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞'],
        'explanation': '–û–º–∞–≥–∞–¥!! –°–æ–≤—Å–µ–º —Å–∫–æ—Ä–æ —É –º–µ–Ω—è –≤—Å—Ç—Ä–µ—á–∞ —Å –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–º!\n \n–° –≤–∞—à–µ–≥–æ –ø–æ–∑–≤–æ–ª–µ–Ω–∏—è, —è –≤–∞—Å –æ—Å—Ç–∞–≤–ª—é! –ù–æ —è —É–≤–µ—Ä–µ–Ω, –≤—ã –ª–µ–≥–∫–æ —Å–ø—Ä–∞–≤–∏—Ç–µ—Å—å —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–¥–∞—á–µ–π!',
        'time_limit': 720,
        'points': 8,
        'files': ['C:\\Users\\akshi\\Downloads\\Telegram Desktop\\qvest\\photo2.jpg']
    },
    {   'task': '*–í—ã –∑–∞—Ö–æ–¥–∏—Ç–µ –≤ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–Ω–∞—Ç—É, –≤ –∫–æ—Ç–æ—Ä–æ–π –µ—Å—Ç—å —Å—Ç—Ä–∞–Ω–Ω–∞—è –º–∞—à–∏–Ω–∫–∞. –û–Ω–∞ –Ω–µ–±–æ–ª—å—à–∞—è, –Ω–æ –∏–∑ —Ç–∞–∫–æ–π –æ–±—ã—á–Ω–æ –≤—ã–ª–µ–∑–∞–µ—Ç –æ—á–µ–Ω—å –º–Ω–æ–≥–æ –∫–ª–æ—É–Ω–æ–≤ ü§°\n \n–†—è–¥–æ–º —Å –º–∞—à–∏–Ω–æ–π –µ—Å—Ç—å –∑–∞–ø–∏—Å–∫–∞, –≤ –∫–æ—Ç–æ—Ä–æ–π –Ω–∞–ø–∏—Å–∞–Ω–æ ¬´–°—è–¥—å—Ç–µ –≤ –º–∞—à–∏–Ω—É –∏ –≥–æ—Ç–æ–≤—å—Ç–µ—Å—å: –º–æ–∂–µ—Ç —Å—Ç–æ—à–Ω–∏—Ç—å¬ª. \n \n–°–µ–≤ –≤ –º–∞—à–∏–Ω—É, –≤—ã —Ä–µ–∑–∫–æ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∏—Å—å –≤ –º—É–∑–µ–π –ì–∞—Ä—Ä–∏ –ü–æ—Ç—Ç–µ—Ä–∞. –ù–æ —á–µ–≥–æ-—Ç–æ –≤ –º—É–∑–µ–µ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç..\n \n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥—É–≥–ª –∫–∞—Ä—Ç—É (https://vk.cc/cmSVfY) –∏ –Ω–∞–π–¥–∏—Ç–µ —Å–ª–æ–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ —Å–ø—Ä—è—Ç–∞–Ω—ã –Ω–∞ —ç—Ç–∏—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è—Ö. –í –æ—Ç–≤–µ—Ç –ø–∏—à–∏—Ç–µ —ç—Ç–∏ —Å–∞–º—ã–µ —Å–ª–æ–≤–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.',
        'answers': ['?scribbulus', '?power', '?flourish', '?quiddich', '?nifflers', '?wheezes'],
        'explanation': '**–≤—ã –æ—Ç–∫—Ä—ã–ª–∏ –∑–∞–≥–∞–¥–æ—á–Ω—É—é –¥–≤–µ—Ä—å –∏ –≤–∞—Å –≤–µ—Ä–Ω—É–ª–æ –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ü–∏—Ä–∫**',
        'time_limit': 1440,
        'points': 10,
        'files': ['C:\\Users\\akshi\\Downloads\\Telegram Desktop\\qvest\\photo11.jpg',
                  'C:\\Users\\akshi\\Downloads\\Telegram Desktop\\qvest\\photo12.jpg',
                  'C:\\Users\\akshi\\Downloads\\Telegram Desktop\\qvest\\photo13.jpg',
                  'C:\\Users\\akshi\\Downloads\\Telegram Desktop\\qvest\\photo14.jpg',
                  'C:\\Users\\akshi\\Downloads\\Telegram Desktop\\qvest\\photo15.jpg',
                  'C:\\Users\\akshi\\Downloads\\Telegram Desktop\\qvest\\photo16.jpg']
    },
    {   'task': '–í–æ—Ç –≤—ã –≥–¥–µ!!! –Ø –≤–∞—Å –∏—â—É —É–∂–µ 20 –º–∏–Ω—É—Ç!!! \n \n–î–∞–≤–∞–π—Ç–µ, —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–π—Ç–µ, –≥–¥–µ –≤—ã –±—ã–ª–∏?!  \n\n –ê —Ö–æ—Ç—è –Ω–µ–≤–∞–∂–Ω–æ!! –ü–æ–∫–∞ –≤–∞—Å –Ω–µ –±—ã–ª–æ, —è –¥–æ–≥–æ–≤–æ—Ä–∏–ª—Å—è —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞–º–∏ –æ —Ç–æ–º, —á—Ç–æ–±—ã –≤—ã–¥–∞—Ç—å –≤–∞–º —Å–∫–∏–¥–∫—É –Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–µ –Ω–∞—à–∏—Ö –∞–Ω–∏–º–∞—Ç–æ—Ä–æ–≤, –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –≤–∞—à–∏ –∑–Ω–∞–Ω–∏—è —Å—Ç–∞–Ω—É—Ç —Å–≤–µ–∂–∏–º–∏, –∫–∞–∫ –ø–æ –≤–æ–ª—à–µ–±—Å—Ç–≤—É. –í—Å—ë-—Ç–∞–∫–∏ –≤—ã –ø–æ–º–æ–≥–ª–∏ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –Ω–∞—à–µ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–µ! –ü–æ—ç—Ç–æ–º—É —É –≤–∞—Å –±—É–¥–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥ –Ω–∞ –†–µ—Ñ—Ä–µ—à üéÅ\n\n–ù–æ —Å–Ω–∞—á–∞–ª–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑–æ–∫ –ø–æ–º–æ–≥–∏—Ç–µ –º–Ω–µ! –£ –º–µ–Ω—è —Ç—É—Ç —Å–ø—Ä–æ—Å–∏–ª–∏ –Ω–µ–¥–∞–≤–Ω–æ: –≤–∏—Å–∏—Ç –≥—Ä—É—à–∞ ‚Äî –Ω–µ–ª—å–∑—è —Å–∫—É—à–∞—Ç—å, —á—Ç–æ —ç—Ç–æ? –ê —è –Ω–µ –∑–Ω–∞—é –æ—Ç–≤–µ—Ç–∞... –ú–æ–∂–µ—Ç, –≤—ã –∑–Ω–∞–µ—Ç–µ? \n\n–î–∞ –Ω–µ —Å–º–µ–π—Ç–µ—Å—å –≤—ã!!! –î–∞, –Ω–µ –∑–Ω–∞—é —è –æ—Ç–≤–µ—Ç–∞! –ê —á—Ç–æ, –≤—ã –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã –∑–Ω–∞–µ—Ç–µ –æ—Ç–≤–µ—Ç—ã??? –ü–æ–º–æ–≥–∏—Ç–µ –ª—É—á—à–µ!',
        'answers': ['?–ª–∞–º–ø–æ—á–∫–∞'],
        'explanation': '–ê –≤–µ–¥—å –∏ –ø—Ä–∞–≤–¥–∞... –ö–∞–∫ —è —ç—Ç–æ–≥–æ –Ω–µ –∑–Ω–∞–ª...',
        'time_limit': 720,
        'points': 2,
        'files': ['C:\\Users\\akshi\\Downloads\\Telegram Desktop\\qvest\\Lampa.jpg']
    },
]

game_data = {}
def start(update: Update, context: CallbackContext):
    chat_id = update.effective_chat.id
    game_data[chat_id] = {'attempts': 5, 'start_time': time.time(), 'task_index': 0, 'code_word_checked': False}
    context.chat_data['task_index'] = 0  # –ó–∞–¥–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –∑–∞–¥–∞–Ω–∏—è
    context.bot.send_message(chat_id=update.effective_chat.id, text="–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø–∞—Ä–∫ –∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω–æ–≤ –í–µ–±–∏—É–º–∞! üé™ \n–£ –Ω–∞—Å —Å–µ–≥–æ–¥–Ω—è –ø–æ–ª–Ω—ã–π –∑–∞–≤–∞–ª, —Å–æ–≤—Å–µ–º —Å–∫–æ—Ä–æ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–µ, –∞ –Ω–∞—à–∏ –∫–ª–æ—É–Ω—ã  —Ä–∞–∑–±–µ–∂–∞–ª–∏—Å—å. \n \n–û–Ω–∏ —Ç–æ–ª—å–∫–æ –æ—Å—Ç–∞–≤–∏–ª–∏ –∑–∞–ø–∏—Å–∫—É: ¬´–ü–æ—è–≤–∏–º—Å—è, –∫–æ–≥–¥–∞ –±—É–¥—É—Ç —Ä–µ—à–µ–Ω—ã –≤—Å–µ –∑–∞–≥–∞–¥–∫–∏!¬ª üòà \n \n–ü–æ–º–æ–≥–∏—Ç–µ –Ω–∞–º, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–π—Ç–∏ –≤—Å–µ—Ö –∫–ª–æ—É–Ω–æ–≤, –≤–µ–¥—å —Å–æ–≤—Å–µ–º —Å–∫–æ—Ä–æ —Å—Ç–∞—Ä—Ç—É–µ—Ç –∫—É—Ä—Å –†–µ—Ñ—Ä–µ—à, –∞ —Ç–æ–ª—å–∫–æ –æ–Ω–∏ –∑–Ω–∞—é—Ç, –∫–∞–∫ –≤—ã–∂–∏—Ç—å –≤ —ç—Ç–æ–º —Ç—Ä–µ—à–µ –∏ –µ—â—ë —Å–¥–∞—Ç—å –ï–ì–≠ –Ω–∞ –≤—ã—Å–æ–∫–∏–π –±–∞–ª–ª‚Ä¶")

    code_word_keyboard = build_code_word_keyboard()
    context.bot.send_message(chat_id=update.effective_chat.id, text="ü§ñ –ö–∞–∫ –Ω–∞–π—Ç–∏ –∫–ª–æ—É–Ω–æ–≤?  \n\n‚ñ´Ô∏è —Ä–∞–∑–≥–∞–¥—ã–≤–∞–π—Ç–µ –∑–∞–≥–∞–¥–∫–∏ \n\n‚ñ´Ô∏è –ø—Ä–∏—Å—ã–ª–∞–π –æ—Ç–≤–µ—Ç –≤ —á–∞—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ ?—Å–ª–æ–≤–æ \n\n‚ñ´Ô∏è –≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ –≤—Å–µ—Ö –∫–ª–æ—É–Ω–æ–≤ –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø–∞—Ä–∫ –∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω–æ–≤ \n\n–£ —Ç–µ–±—è –±—É–¥–µ—Ç 5 –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ, –ø–æ–µ—Ö–∞–ª–∏ üëáüèª", reply_markup=code_word_keyboard)

def build_code_word_keyboard():
    keyboard = [
        [InlineKeyboardButton("–ü–æ–µ—Ö–∞–ª–∏!", callback_data="code_word")]
    ]
    return InlineKeyboardMarkup(keyboard)

def code_word_button(update: Update, context: CallbackContext):
    query = update.callback_query
    chat_id = update.effective_chat.id

    if chat_id not in game_data:
        context.bot.send_message(chat_id=update.effective_chat.id, text="–ò–≥—Ä–∞ –Ω–µ –Ω–∞—á–∞—Ç–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.")
        return

    if game_data[chat_id].get('code_word_checked'):
        return

    game_data[chat_id]['code_word_checked'] = True
    context.bot.send_message(chat_id=update.effective_chat.id, text="–£—Ä–∞–∞–∞! –°–ø–∞—Å–∏–±–æ –≤–∞–º!! –°–∫–æ—Ä–µ–µ –ø–æ–±–µ–∂–∞–ª–∏ –∏—Å–∫–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ –∫–ª–æ—É–Ω–∞!")
    send_task(update, context)
    query.answer()

def send_task_on_code(update: Update, context: CallbackContext):
    code_word = "–ö–æ–Ω–µ—á–Ω–æ!"
    chat_id = update.effective_chat.id

    if chat_id not in game_data:
        context.bot.send_message(chat_id=update.effective_chat.id, text="–ò–≥—Ä–∞ –Ω–µ –Ω–∞—á–∞—Ç–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.")
        return

    if game_data[chat_id].get('code_word_checked'):
        return

    if update.message.text.strip().lower() == code_word.lower():
        game_data[chat_id]['code_word_checked'] = True
        send_task(update, context)
    else:
        context.bot.send_message(chat_id=update.effective_chat.id, text="–ù–µ–≤–µ—Ä–Ω–æ–µ –∫–æ–¥–æ–≤–æ–µ —Å–ª–æ–≤–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.")

def send_task(update, context, chat_data=None, chat_id=None):
    if update:
        chat_id = update.effective_chat.id
    if not chat_data:
        chat_data = context.chat_data

    task_index = chat_data['task_index']
    current_task = TASKS[task_index]
    chat_data['current_task'] = current_task 
    task_text = current_task['task']
    media_files = current_task['files']
    media_group = [InputMediaPhoto(media=open(media_files[0], 'rb'), caption=task_text)]

    for media_file in media_files[1:]:
        if media_file.lower().endswith(('.jpg', '.jpeg', '.png')):
            media_group.append(InputMediaPhoto(media=open(media_file, 'rb')))

    context.bot.send_media_group(chat_id=chat_id, media=media_group)

    for media_file in media_files:
        if media_file.lower().endswith(('.mp3', '.wav', '.ogg')):
            context.bot.send_audio(chat_id=chat_id, audio=open(media_file, 'rb'))
    
    for media_file in media_files:
        if media_file.lower().endswith(('.mp4')):
            context.bot.send_video(chat_id=chat_id, video=open(media_file, 'rb'))   

MAX_ATTEMPTS = 5
def check_answer(update: Update, context: CallbackContext) -> None:
    context.chat_data.setdefault('guessed_answers', [])
    chat_id = update.effective_chat.id
    context.chat_data['chat_id'] = chat_id
    
    task_index = context.chat_data.get('task_index', 0)
    user = update.message.from_user
    user_answer = update.message.text.lower()
    logger.info("Answer of %s: %s", user.first_name, user_answer)

    current_task = TASKS[task_index]
    task_index = context.chat_data.get('task_index', 0)

    if context.chat_data.get('last_task_index', None) != task_index:
        if 'answer' in current_task:
            context.chat_data['answers'] = [current_task['answer'].lower()]
        elif 'answers' in current_task:
            context.chat_data['answers'] = [answer.lower() for answer in current_task['answers']]
        else:
            context.chat_data['answers'] = []
        context.chat_data['last_task_index'] = task_index

    answers = context.chat_data['answers']

    if user_answer in answers:
            logger.info("User's answer is in expected answers.")
            context.chat_data['guessed_answers'].append(user_answer)
            answers.remove(user_answer)


            if not answers:
                context.chat_data['attempts'] = 5 
                points = current_task['points']
                update.message.reply_text(f"–û–≥–æ–æ–æ–æ! –ò –ø—Ä–∞–≤–¥–∞! –ó–∞ —ç—Ç–æ –≤–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç {points} –±–∞–ª–ª–æ–≤! –ö—Ä—É—Ç–æ—Ç–∞!!!")
                task_index = context.chat_data['task_index']
                explanation = current_task['explanation']
                if explanation.strip():
                    update.message.reply_text(explanation)
                if 'points' not in context.chat_data:
                    context.chat_data['points'] = 0 
                context.chat_data['points'] += points
                if task_index >= 6:
                    update.message.reply_text(f"–°—á–∏—Ç–∞—é –≤—Å–µ –±–∞–ª–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –∑–∞—Ä–∞–±–æ—Ç–∞–ª–∏... \n–†–µ–∑—É–ª—å—Ç–∞—Ç —Å—É–º–∞—à–µ–¥—à–∏–π! –Ø –∏ –Ω–µ –∑–Ω–∞–ª, —á—Ç–æ —Ç–∞–∫–æ–µ –≤–æ–∑–º–æ–∂–Ω–æ... –¶–µ–ª—ã—Ö {context.chat_data['points']} –±–∞–ª–ª–æ–≤ –Ω–∞–±—Ä–∞–ª–∞ –≤–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞! –ü–æ–∑–¥—Ä–∞–≤–ª—è—é!!")
                    update.message.reply_text(f"–ó–Ω–∞–µ—Ç–µ, —Ä–∞–∑ –≤—Å–µ –¥–µ–ª–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å, –ø—Ä–µ–¥–ª–∞–≥–∞—é —Å–æ–±—Ä–∞—Ç—å—Å—è –≤—Å–µ–º –≤–º–µ—Å—Ç–µ –∏ –æ–±—Å—É–¥–∏—Ç—å –∏–≥—Ä—É! –¢–æ–ª—å–∫–æ –Ω–µ —Ç—É—Ç, –∞ –≤ —ç—Ç–æ–π... –ö–∞–∫ —Ç–∞–º –µ–≥–æ... –¢–µ–ª–µ–≥—Ä–∞–º–º–∞—Ö! \n–ê –Ω–µ—Ç.. –í —Ç–µ–ª–µ–ª–µ–≥—Ä–∞–º-—á–∞—Ç–µ! –õ–æ–≤–∏—Ç–µ —Å—Å—ã–ª–æ—á–∫—É: https://t.me/+5ZxjGDP-t_xjZmIy \n\nü§ñ –ñ–¥—É –≤—Å–µ—Ö!!")
                if task_index + 1 < len(TASKS):
                    context.chat_data['task_index'] += 1
                    context.chat_data['guessed_answers'] = []
                    context.job_queue.run_once(lambda _, u=update, c=context: send_task(u, c), 5)
                    answers = context.chat_data['answers']
            else:
                update.message.reply_text(f"–û—Ç–≤–µ—Ç –ø—Ä–∏–Ω—è—Ç! –ù–æ –µ—â–µ –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–≥–∞–¥–∞—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ!")

    else:
        if 'attempts' not in context.chat_data:
            context.chat_data['attempts'] = MAX_ATTEMPTS - 1
        else:
            context.chat_data['attempts'] -= 1

        if context.chat_data['attempts'] > 0:
            update.message.reply_text(f"–ë–ª–∏–Ω, –∫–∞–∂–µ—Ç—Å—è –Ω–µ —Ç–æ... –ë—ã—Ç—å –º–æ–∂–µ—Ç, –µ—Å—Ç—å –µ—â–µ –∏–¥–µ–∏? –û—Å—Ç–∞–ª–æ—Å—å {context.chat_data['attempts']} –ø–æ–ø—ã—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∏—Ç—å...")
        else:
            update.message.reply_text("–ë–ª–∏–Ω, –∫–∞–∂–µ—Ç—Å—è –∫–ª–æ—É–Ω —É–±–µ–∂–∞–ª... –ù—É –Ω–∏—á–µ–≥–æ —Å—Ç—Ä–∞—à–Ω–æ–≥–æ! –Ø –¥—É–º–∞—é, —ç—Ç–æ –Ω–µ –ø–æ–º–µ—à–∞–µ—Ç –Ω–∞–º —É—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ—Ñ—Ä–µ—à, –ø–æ—ç—Ç–æ–º—É –∏—â–µ–º —Å–ª–µ–¥—É—é—â–µ–≥–æ!")
            context.chat_data['attempts'] = MAX_ATTEMPTS
            if current_task == 5:
                explanation = current_task['explanation']
                if explanation.strip():
                    update.message.reply_text(explanation)
            elif task_index + 1 < len(TASKS):
                context.chat_data['task_index'] += 1
                context.chat_data['guessed_answers'] = []
                send_task(update, context)
    logger.info("Current task: %s", current_task)
    logger.info("Expected answers: %s", answers)
    logger.info("User's answer: %s", user_answer)

def add_points(chat_id: int, points: int, elapsed_time: float):
    with open("results.txt", "a") as results_file:
        results_file.write(f"Chat ID: {chat_id}, Points: {points}, Elapsed time: {elapsed_time:.2f} seconds\n")

def main():
    updater = Updater(token=TELEGRAM_API_TOKEN)

    dispatcher = updater.dispatcher
    dispatcher.add_handler(CommandHandler("start", start))
    dispatcher.add_handler(MessageHandler(Filters.regex(r'^\?'), check_answer))
    dispatcher.add_handler(CallbackQueryHandler(code_word_button, pattern='^code_word$'))

    updater.start_polling()
    updater.idle()


if __name__ == '__main__':
    main()
